# アーキテクチャ・設計

### スケールアウト（Scale-out） / スケールイン（Scale-in）
サーバーの台数を増やして処理を分散するのがスケールアウト。<br>逆に台数を減らしてコストを下げるのがスケールイン。<br>

メリット： 同時接続数や並列処理能力を簡単に伸ばせる。可用性（冗長化）も向上する。<br>
注意点： セッション管理やデータ整合性、設定の同期が必要になることが多い。

---

### スケールアップ（Scale-up） / スケールダウン（Scale-down）
既存のサーバー自体のCPUやメモリ、ディスク容量を増やして性能を上げるのがスケールアップ。<br>逆にリソースを下げるのがスケールダウン。<br>

メリット： 単純に処理性能を上げやすく、アプリ側の設計変更が少ない場合がある。<br>
注意点： 物理的・インスタンスの上限があり、スケールアウトほど柔軟でない。ダウンタイムが発生する可能性がある。

---

### フェイルオーバー（Failover）
システム障害が発生した際に、自動的に予備系（待機系）のサーバーやシステムに切り替えて、サービスを継続する仕組み。<br>
「障害時の自動切り替え」と理解すればよい。<br>

**主な目的:** 可用性の向上（システムを止めないこと）。障害発生時のダウンタイムを最小化する。<br>

**フェイルオーバーの構成例:**<br>
```
アクティブ・スタンバイ構成（ホットスタンバイ）:
┌─────────┐
│サーバーA│  
│(稼働中) │   障害発生！
└─────────┘ 
 ↓ 切り替え         
┌─────────┐
│サーバーB│
│(待機中) │ → 稼働開始
└─────────┘


アクティブ・アクティブ構成:
┌─────────┐
│サーバーA│ ← 両方とも稼働中
│(稼働中) │    負荷分散
└─────────┘
┌─────────┐
│サーバーB│ ← Aが落ちても
│(稼働中) │    Bが全て処理
└─────────┘
```

**スケールアウトとの違い:**<br>

| 項目 | スケールアウト | フェイルオーバー |
|------|---------------|------------------|
| **主な目的** | 性能向上・負荷分散 | 可用性向上・障害対策 |
| **サーバーの役割** | 全台が常に稼働して負荷分散 | 予備系は待機（または軽負荷） |
| **障害時の動作** | 残りのサーバーで処理継続 | 予備系へ自動切り替え |
| **導入理由** | 「遅い」を解決 | 「止まらない」を実現 |

**重要な違い:**<br>
- **スケールアウト**: 複数サーバーが同時に処理して性能を上げる。結果的に1台落ちても大丈夫だが、本来の目的は「速くすること」。<br>
- **フェイルオーバー**: 障害時に切り替えることが目的。性能向上は副次的効果。<br>

**実際の関係性:**<br>
スケールアウト構成（複数サーバー）を組むと、自然とフェイルオーバー能力も得られることが多い。<br>
しかし、フェイルオーバーのために必ずしもスケールアウトが必要なわけではない（アクティブ・スタンバイ構成は2台だけ）。<br>

**使われる場面:**<br>
- データベースサーバー（マスター・スレーブ構成）<br>
- Webサーバー（ロードバランサー配下で自動切り替え）<br>
- ネットワーク機器（ルーター、ファイアウォールの冗長化）<br>
- クラウドサービス（AWSのMulti-AZ、Azureの可用性セット）<br>

**フェイルバック:**<br>
障害が復旧した後、元の主系（サーバーA）に戻す作業をフェイルバックという。<br>
自動で戻す場合もあれば、手動で戻す場合もある。<br>

---

### クラスタ構成（クラスター）／クラスタリング
複数のサーバーやノードを**1つのまとまり（クラスター）として連携させる構成**。<br>
アクティブ・アクティブでもアクティブ・スタンバイでも、外からは「1つのサービス」として見える設計。<br>
**性能向上・可用性・運用性など、複合的な目的**で導入されることが多い。<br>

**よくある目的:**<br>
- **可用性**（止まらない）を上げる<br>
- **性能**（さばける量）を上げる<br>
- **運用性**（メンテしやすい）を上げる<br>

**代表的なクラスタの形:**<br>
- **アクティブ・アクティブ**: 全台稼働で負荷分散（性能向上に強い）<br>
- **アクティブ・スタンバイ**: 片方稼働・片方待機（可用性重視）<br>

**スケールアウトとの関係:**<br>
- クラスタ構成は**複数台で動かす「仕組み」**<br>
- スケールアウトは**台数を増やす「手段」**<br>
→ つまり、スケールアウトはクラスタリングの一部として行われることが多い。<br>

**フェイルオーバーとの関係:**<br>
- クラスタ構成の中に**フェイルオーバー機能**が含まれることが多い（自動切り替え）。<br>

**冗長化との違い:**<br>
- **冗長化**: 基本的に**可用性（止まらない）目的が中心**。性能向上は主目的ではない。<br>
- **クラスタ構成**: 可用性だけでなく、**性能向上や負荷分散も含む**設計。<br>

**「クラスタ○○」の読み方:**<br>
クラスタDB、クラスタストレージなど「クラスタ○○」と呼ばれる場合、<br>
**複数台で構成された○○（HA・性能・負荷分散など複合的な目的）** という意味。<br>
単純な冗長化だけでなく、性能面の向上も含む場合が多い。<br>

**使われる場面:**<br>
- Webサーバーの冗長化（ロードバランサー配下）<br>
- データベースの冗長化（クラスタDB）<br>
- 共有ストレージの冗長化<br>

**注意点:**<br>
- セッション共有やデータ同期など、**複数台で整合性を保つ設計**が必要。<br>
- 構成が複雑になる分、運用コストは上がりやすい。<br>

「複数台で1つのシステムを作る考え方」そのものがクラスタ構成。<br>

---

### DevOps（デブオプス）
Development（開発）とOperations（運用）を組み合わせた造語。<br>
開発チームと運用チームの協力を促進する管理体制・文化・手法の総称。<br>
特定のサービスやツールではなく、組織運営の考え方や哲学を指す。<br>

**従来の問題:** 開発と運用が分離されていて、コミュニケーション不足や対立が発生。<br>
**DevOpsの解決策:** チーム間の壁を取り払い、共通目標に向けて協力する文化を醸成。<br>

**実践例:** CI/CD（自動テスト・自動デプロイ）、監視・フィードバック、アジャイル開発<br>
**関連ツール:** Azure DevOps、Jenkins、Docker、Kubernetesなど（ツール自体がDevOpsではない）<br>

---

### UAT環境（User Acceptance Test／ユーエーティー環境）
**別名:** 受け入れ環境、ユーザー受入テスト環境、承認環境<br>

User Acceptance Testの略。<br>
本番リリース前にユーザー（または発注者・利用部門）が最終確認を行うための検証環境。<br>
開発したシステムが要件を満たしているか、実際の業務で使えるかを確認する最終ステップ。

**環境の流れ（あくまで一般的な例）:**<br>
```
開発環境 → STG環境 → UAT環境 → 本番環境
(Dev)      (STG)    (UAT)    (Production)
```

**UAT環境の特徴:**<br>
- 本番と同じ構成・データで実施されることが多い<br>
- ユーザーが実際の業務フローで動作確認<br>
- ここで承認されて初めて本番リリースへ進む<br>
- 開発チームではなく、発注者側やエンドユーザーが主体<br>

**ステージング環境との違い:**<br>

| 項目 | ステージング環境 | UAT環境 |
|------|-----------------|---------|
| **主な目的** | 技術的な最終動作確認・リハーサル | ユーザーによる業務受け入れテスト |
| **誰が使う** | 開発チーム・運用チーム | エンドユーザー・発注者 |
| **確認内容** | 本番と同じ動作をするか | 業務要件を満たすか |
| **位置づけ** | デプロイ前の最終検証 | 承認のための環境 |

**現場での運用パターン:**<br>
- **パターン1**: ステージング環境とUAT環境が別々に存在（大規模プロジェクト）<br>
- **パターン2**: 同じ環境をステージング・UAT両方の用途で使用（中小規模）<br>
- **パターン3**: ステージング→UAT の順に同じ環境で実施<br>

UAT環境は、本番一歩手前の「最終関門」として機能する重要な環境。<br>

---

### クラウドサービスの4層構造（IaaS、PaaS、SaaS、IPaaS）
クラウドサービスを「どこまでクラウド事業者が管理してくれるか」で分類した構造。<br>
下層ほど利用者の管理範囲が広く、上層ほどクラウド事業者が多くを管理してくれる。<br>

**IaaS（Infrastructure as a Service）:** 仮想的なハードウェアを提供。仮想サーバー（VM）、仮想ネットワークなど。<br>
例: Azure Virtual Machines、AWS EC2、Azure Virtual Network<br>

**PaaS（Platform as a Service）:** アプリケーション実行環境を提供。OSやミドルウェアは管理不要。<br>
例: Azure App Service、Azure Container Apps、AWS Lambda<br>

**SaaS（Software as a Service）:** 完成したソフトウェアをそのまま利用。<br>
例: Microsoft 365、Gmail、Salesforce<br>

**IPaaS（Integration Platform as a Service）:** システム間連携を簡単にするツールを提供。<br>
例: Azure Logic Apps、AWS Step Functions<br>
